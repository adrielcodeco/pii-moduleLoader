{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Copyright 2018-present, CODECO. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport * as path from 'path'\n\nconst Module: any = module.constructor\n\nclass ModuleLoader {\n  private aliases: { alias: string; path: string }[] = []\n  private _resolveFilenameOld: Function\n  private _loadOld: Function\n\n  constructor () {\n    this._resolveFilenameOld = Module._resolveFilename\n    this._loadOld = Module._load\n    Module._resolveFilename = this._resolveFilename.bind(this)\n    Module._load = this._load.bind(this)\n  }\n\n  public useAlias (alias: string, path: string) {\n    const _alias = this.aliases.filter(a => a.alias === alias).find(i => true)\n    if (_alias) {\n      _alias.path = path\n    } else {\n      this.aliases.push({ alias, path })\n    }\n  }\n\n  private _resolveFilename (\n    request: string,\n    parent: any,\n    isMain: boolean,\n    options: any\n  ) {\n    const alias = this.aliases\n      .filter(a => request.startsWith(a.alias + '/') || a.alias === request)\n      .sort((a1, a2) => {\n        if (a1.alias.length < a2.alias.length) return 1\n        if (a1.alias.length > a2.alias.length) return -1\n        return 0\n      })\n      .find(i => true)\n    if (alias) {\n      const aliaspath =\n        alias.alias === request\n          ? alias.path\n          : path.resolve(alias.path, '.' + request.replace(alias.alias, ''))\n      return this._resolveFilenameOld(aliaspath, parent, isMain, options)\n    } else {\n      return this._resolveFilenameOld(request, parent, isMain, options)\n    }\n  }\n\n  private _load (request: string, parent: any, isMain: boolean) {\n    const _exports = this._loadOld(request, parent, isMain)\n    if (\n      typeof _exports === 'object' &&\n      Reflect.ownKeys(_exports).length > 0 &&\n      (process.env.NODE_ENV || 'development') in _exports\n    ) {\n      if (typeof _exports.default === 'object') {\n        _exports.default = Object.assign(\n          {},\n          _exports.default,\n          _exports[process.env.NODE_ENV || 'development']\n        )\n      } else {\n        _exports.default =\n          _exports[process.env.NODE_ENV || 'development']\n      }\n    }\n    return _exports\n  }\n}\n\nconst moduleLoader = new ModuleLoader()\n\nexport default function useAlias (alias: string, path: string) {\n  moduleLoader.useAlias(alias, path)\n}\n"]}